<div class="pagewrapper">
  <div class="header">
    <button class="back-btn" (click)="backTo()">
      <img
        src="../../../assets/images/icons8-chevron-right-24.png"
        alt="chevron"
        width="18"
      />
      Back
    </button>
  </div>

  <form [formGroup]="testimonialForm" (ngSubmit)="save()">
    <div class="card">
      <label>Reviewer Name</label>
      <input
        type="text"
        placeholder="Enter name"
        formControlName="reviewerName"
      />

      <label style="margin-top: 16px">Date</label>
      <input type="date" formControlName="date" />

      <div class="ratingWrp">
        <div class="ratinglabel">
          <h3>Rating</h3>
          <div class="checkbox">
            <input type="checkbox" id="starColor" checked />
          </div>
        </div>
        <div class="stars">
          <span
            *ngFor="let star of stars"
            (click)="setRating(star)"
            [class.filled]="star <= testimonialForm.get('rating')?.value"
          >
            ★
          </span>
          <span class="rating-value"
            >{{ testimonialForm.get("rating")?.value }}/5</span
          >
        </div>
      </div>
    </div>

    <div class="card">
      <div class="avatar-wrapper">
        <div class="labelWrp">
          <label>Avatar</label>
          <div class="avatar-toggle">
            <input
              type="checkbox"
              id="avatarToggle"
              [checked]="testimonialForm.get('avatar')?.value"
              (change)="toggleAvatar($event)"
            />
            <label for="avatarToggle"></label>
          </div>
        </div>

        <div class="avatar-type">
          <label class="avatar-radio">
            <input
              type="radio"
              name="avatarType"
              value="image"
              [checked]="testimonialForm.get('avatarType')?.value === 'image'"
              (change)="setAvatarType('image')"
            />
            Image/Icon
          </label>
          <!-- Remove 'Letters' as requested -->
        </div>

        <div class="upload-box" (click)="fileInput.click()">
          <input
            type="file"
            hidden
            accept="image/*"
            #fileInput
            (change)="onFileSelected($event)"
          />

          <ng-container *ngIf="imagePreview; else uploadPlaceholder">
            <div class="image-preview">
              <img [src]="imagePreview" alt="Preview" />
              <button class="delete-btn" (click)="onDeleteImage($event)">
                ✖
              </button>
            </div>
          </ng-container>

          <!-- Placeholder shown when imagePreview is null -->
          <ng-template #uploadPlaceholder>
            <div class="upload-content">
              <span class="upload-icon">⬆️</span>
              <div class="upload-text">
                Supports JPG, PNG<br />Max file size: 5MB
              </div>
            </div>
          </ng-template>
        </div>
      </div>
    </div>

    <div class="card">
      <label>Quote</label>
      <textarea
        formControlName="quote"
        placeholder="Type your quote here..."
        rows="4"
      ></textarea>
    </div>

    <div class="buttons">
      <button type="button" class="btn cancelBtn">Cancel</button>
      <button
        type="submit"
        class="btn saveBtn"
        [disabled]="testimonialForm.invalid"
      >
        Save
      </button>
    </div>
  </form>
</div>
