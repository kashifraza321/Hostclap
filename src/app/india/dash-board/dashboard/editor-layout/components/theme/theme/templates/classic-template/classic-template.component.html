<ng-container *ngIf="isLoading; else content">
  <app-loader></app-loader>
</ng-container>
<ng-template #content>
  <div class="classicWrapper" #scrollContainer>
    <ng-container *ngIf="state$ | async as state">
      <div class="url-bar">
        <div class="dots">
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
        <div class="url-content">
          <img
            src="../../../../../../../../../../assets/images/"
            alt="lock"
            class="lock-icon"
          />
          <span class="url-text">https://acrserviceranchi.com</span>
        </div>
      </div>
      <div *ngIf="state$ | async as state">
        <div
          class="top-bar"
          [ngStyle]="{
            background: data?.selectedColor?.primary || '#f88d00',
            'font-size.px':
              state?.preview?.announcement?.fontSize ||
              pageData?.header?.announcement?.fontSize ||
              '16px',

            color:
              state?.preview?.announcement?.fontColor ||
              pageData?.header?.announcement?.fontColor ||
              '#fff'
          }"
        >
          <span
            [innerHTML]="
              state?.preview?.announcement?.message?.trim() ||
              pageData?.header?.announcement?.message?.trim() ||
              'AC Repairing ?'
            "
          ></span>
          <div
            *ngIf="
              state?.preview?.announcement?.actionButton !== false &&
              pageData?.header?.announcement?.actionButton !== false
            "
          >
            <button *ngIf="state?.preview?.announcement?.actionButton">
              {{
                state?.preview?.announcement?.actionButton?.buttonText ||
                  pageData?.header?.announcement?.actionButton?.buttonText ||
                  "Send a message"
              }}
            </button>
          </div>
        </div>
      </div>

      <!-- Top Bar -->

      <!-- new bar -->
      <div
        class="classic-top-bar"
        [ngStyle]="{
          background: data?.selectedColor?.primary || '#9C27B0'
        }"
      >
        <span class="topBarText" [ngStyle]="{ 'font-family': data?.font }"
          >Need AC Help?</span
        >
        <button class="classic-btn" [ngStyle]="{ 'font-family': data?.font }">
          Contact Us
        </button>
      </div>
      <!-- announcement -->

      <!-- announcement -->

      <!-- Header Info -->
      <header class="classic-header-info">
        <div [ngStyle]="{ 'font-family': data?.font }">
          <i class="bi bi-geo-alt-fill"></i>
          <span class="addresTXt">Lalpur, Ranchi, Jharkhand</span>
        </div>
        <div>
          <i class="bi bi-telephone-fill"></i>
          <!-- <pre>{{ pageData | json }}</pre> -->
          {{ pageData?.header?.phones?.mobile }}
        </div>
      </header>

      <!-- Navigation -->
      <nav
        [class.scrolled]="isScrolled"
        class="classic-nav"
        [ngStyle]="{
          background: !isScrolled
            ? state?.preview?.menu?.menuBackgroudColour ||
              pageData?.header?.menu?.menuBackgroudColour
            : 'transparent',

          'font-size':
            state?.preview?.menu?.fontSize ||
            pageData?.header?.menu?.fontSize ||
            '16px',
          'text-align':
            state?.preview?.menu?.alignment ||
            pageData?.header?.menu?.alignment ||
            'left'
        }"
      >
        <div
          class="logoSection"
          [class.scrolled]="isScrolled"
          *ngIf="state$ | async as state"
        >
          <!-- <img
          src="../../../../../../../../../../assets/images/icons8-huawei-logo-64.png"
          alt="logo"
          width="70"
          height="70"
        /> -->
          <!-- <img
          [src]="getSanitizedLogoUrl()"
          [ngStyle]="{
            width: logoForm.get('logoSize')?.value + 'px',
            'text-align': logoForm.get('alignment')?.value
          }"
          alt="logo"
          width="70"
          height="70"
        /> -->
          <div
            [ngStyle]="{
              'text-align':
                state?.preview?.logo?.alignment ||
                pageData?.header?.logo?.alignment ||
                'center'
            }"
          >
            <img
              [src]="getLogoUrl()"
              [ngStyle]="{
                width:
                  (state?.preview?.logo?.logoSize ||
                    pageData?.header?.logo?.logoSize ||
                    70) + 'px'
              }"
              alt="logo"
            />
          </div>
        </div>
        <ul>
          <!-- <li *ngFor="let page of data?.pageData">
        <a href="#">{{ page.pageName }}</a>
      </li> -->
          <li *ngFor="let page of pagesList; let i = index">
            <a
              href="javascript:void(0)"
              (click)="scrollToSection('page-' + i)"
              [ngStyle]="{
                color:
                  state?.preview?.menu?.menuFontColour ||
                  pageData?.header?.menu?.menuFontColour,

                'font-size':
                  state?.preview?.menu?.fontSize ||
                  pageData?.header?.menu?.fontSize ||
                  '15px',
                'text-align':
                  state?.preview?.menu?.alignment ||
                  pageData?.header?.menu?.alignment ||
                  'left'
              }"
              >{{ page.pageName }}</a
            >
          </li>
        </ul>
      </nav>

      <!-- Hero -->
      <!-- {{ getCoverUrl() | json }} -->
      <section
        class="classic-hero hero"
        *ngIf="state$ | async as state"
        [style.background-image]="getCoverUrl(state)"
        [ngStyle]="{
          opacity:
            (state?.preview?.cover?.opacity ||
              pageData?.header?.cover?.opacity ||
              100) / 100
        }"
      >
        <div class="overlay">
          <div class="hero-text" *ngIf="state$ | async as state">
            <h1
              [ngStyle]="{
                'font-family': data?.font,
                color:
                  state?.preview?.titles?.titleColour ||
                  pageData?.header?.titles?.titleColour,

                'text-align':
                  state?.preview?.titles?.titleAlignment ||
                  pageData?.header?.titles?.titleAlignment ||
                  'left'
              }"
            >
              {{
                state?.preview?.titles?.buisnessName ||
                  pageData?.header?.titles?.buisnessName ||
                  "Your Main Title"
              }}
            </h1>
            <p
              [ngStyle]="{
                'font-family': data?.font,
                color:
                  state?.preview?.titles?.subtitleColour ||
                  pageData?.header?.titles?.subtitleColour,

                'text-align':
                  state?.preview?.titles?.subtitleAlignment ||
                  pageData?.header?.titles?.subtitleAlignment ||
                  'left'
              }"
            >
              {{
                state?.preview?.titles?.subtitle ||
                  pageData?.header?.titles?.subtitle ||
                  "Your subtitle"
              }}
            </p>
          </div>
        </div>
      </section>
      <section id="page-0" class="dynamicPages">
        <div class="dymanic-page-header">
          <h2 class="">{{ pagesList[0]?.pageName }}</h2>
        </div>
      </section>
      <!-- offer -->
      <section class="offerSection">
        <div class="mainContainer">
          <div
            class="offer-banner"
            [ngStyle]="{ background: data?.selectedColor?.primary }"
          >
            <div
              class="yellow-polygon"
              [ngStyle]="{ background: data?.selectedColor?.secondary }"
            >
              <img
                src="../../../../../../../../../../assets/images/icons8-discount-48.png"
                alt="Offer"
              />
            </div>
            <div class="offer-text">
              <h3>
                {{
                  state?.preview?.offer?.title ||
                    pageData?.offer?.title ||
                    "offer"
                }}
              </h3>
              <p>
                <span
                  [innerHTML]="
                    state?.preview?.offer?.description?.trim() ||
                    pageData?.offer?.description?.trim() ||
                    'AC Repairing ?'
                  "
                >
                </span>
              </p>
            </div>
          </div>
        </div>
      </section>
      <!-- gallery section -->
      <section class="gallery-section">
        <div class="mainContainer">
          <div *ngIf="pageData?.gallery?.images?.length">
            <h2 class="gallery-title" *ngIf="pageData?.gallery?.titleVisible">
              {{ pageData.gallery.title }}
            </h2>

            <div class="gallery-grid">
              <!-- Row 1 (3 images) -->
              <div class="row-1">
                <div
                  class="gallery-item"
                  *ngFor="let img of pageData.gallery.images.slice(0, 3)"
                >
                  <img [src]="getGalleryImageUrl(img)" alt="Gallery Image" />
                </div>
              </div>

              <!-- Row 2 (2 images) -->
              <div class="row-2">
                <div
                  class="gallery-item"
                  *ngFor="let img of pageData.gallery.images.slice(3, 5)"
                >
                  <img [src]="getGalleryImageUrl(img)" alt="Gallery Image" />
                </div>
              </div>

              <!-- Row 3 (5 images) -->
              <div class="row-3">
                <div
                  class="gallery-item"
                  *ngFor="let img of pageData.gallery.images.slice(5, 10)"
                >
                  <img [src]="getGalleryImageUrl(img)" alt="Gallery Image" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- gallery section -->
      <!-- testimonial section -->
      <div class="testimonial-section dynamicPages">
        <div class="dymanic-page-header">
          <h2>Testimonials</h2>
        </div>
        <div class="mainContainer">
          <div *ngFor="let group of testimonialGroups" class="testimonial-card">
            <div class="testIMg">
              <img
                *ngIf="group.testimonial.imageUrlSafe"
                [src]="group.testimonial.imageUrlSafe"
                alt="Avatar"
                class="avatar"
              />
            </div>
            <h3>{{ group.testimonial.reviewerName }}</h3>
            <p class="quote">{{ group.testimonial.quote }}</p>
            <p class="date">
              {{ group.testimonial.date | date : "mediumDate" }}
            </p>

            <!-- Rating stars -->
            <div class="rating">
              <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                <span
                  class="star"
                  [class.filled]="star <= +group.testimonial.rating"
                  [style.color]="group.testimonial.ratingColour || 'red'"
                  >&#9733;</span
                >
              </ng-container>
            </div>
          </div>
        </div>
      </div>

      <!-- testimonial section -->

      <div class="serviceSection">
        <div class="mainContainer">
          <div class="serviceHeading" [ngStyle]="{ 'font-family': data?.font }">
            <h2>
              {{
                state?.preview?.offer?.title ||
                  serviceData?.section?.sectionTitle ||
                  "offer"
              }}
            </h2>
          </div>

          <ng-container
            *ngFor="let group of serviceData?.section?.groups; let i = index"
          >
            <input
              type="radio"
              name="groupStep"
              [id]="'group' + i"
              [checked]="i === 0"
              hidden
            />

            <div class="group">
              <h2
                class="section-title"
                [ngStyle]="{ 'font-family': data?.font }"
              >
                {{ group.groupName }}
              </h2>

              <div class="service-container">
                <div
                  class="service-card"
                  *ngFor="
                    let sub of group?.subgroups.slice(0, visibleSubgroupsCount)
                  "
                >
                  <div class="imgWrp">
                    <img
                      [src]="getImageUrl(sub.media?.[0])"
                      alt="{{ sub.subgroupName || 'Service Image' }}"
                      class="service-image"
                    />
                  </div>

                  <div
                    class="service-title"
                    [ngStyle]="{ 'font-family': data?.font }"
                  >
                    {{ sub.subgroupName }}
                  </div>

                  <div
                    class="service-desc"
                    [ngStyle]="{ 'font-family': data?.font }"
                  >
                    {{ sub.description }}
                  </div>

                  <a
                    href="#"
                    class="learn-more"
                    [ngStyle]="{ 'font-family': data?.font }"
                  >
                    Learn more
                  </a>

                  <button class="btn" [ngStyle]="{ 'font-family': data?.font }">
                    Request Service
                  </button>
                </div>
              </div>
              <div
                class="buttonCont"
                *ngIf="visibleSubgroupsCount < (group?.subgroups?.length || 0)"
              >
                <button class="loadMore_btn" (click)="loadMore()">
                  Load More
                </button>
              </div>

              <div class="controls">
                <!-- Next button -->
                <label
                  *ngIf="i < serviceData?.section?.groups.length - 1"
                  [for]="'group' + (i + 1)"
                  class="btn"
                >
                  Next
                </label>

                <!-- Previous button -->
                <label *ngIf="i > 0" [for]="'group' + (i - 1)" class="btn">
                  Previous
                </label>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Services -->
      <div *ngIf="" class="serviceSection">
        <div class="mainContainer">
          <div class="serviceHeading" [ngStyle]="{ 'font-family': data?.font }">
            {{
              state?.preview?.offer?.title ||
                serviceData?.section?.sectionTitle ||
                "offer"
            }}
          </div>
          <div
            *ngFor="let group of serviceData?.section?.groups; let i = index"
          >
            <input
              type="radio"
              name="groupStep"
              [id]="'group' + i"
              [checked]="i === 0"
              hidden
            />
            <h2 class="section-title" [ngStyle]="{ 'font-family': data?.font }">
              {{ group.groupName }}
              <!-- {{ group.groupName }} -->
            </h2>

            <div class="service-container">
              <div
                class="service-card"
                *ngFor="let sub of serviceData?.section?.groups[0]?.subgroups"
              >
                <div class="imgWrp">
                  <img
                    [src]="getImageUrl(sub.media?.[0])"
                    alt="{{ sub.subgroupName || 'Service Image' }}"
                    class="service-image"
                  />
                </div>

                <div
                  class="service-title"
                  [ngStyle]="{ 'font-family': data?.font }"
                >
                  {{ sub.subgroupName }}
                </div>

                <div
                  class="service-desc"
                  [ngStyle]="{ 'font-family': data?.font }"
                >
                  {{ sub.description }}
                </div>

                <a
                  href="#"
                  class="learn-more"
                  [ngStyle]="{ 'font-family': data?.font }"
                >
                  Learn more
                </a>

                <button class="btn" [ngStyle]="{ 'font-family': data?.font }">
                  Request Service
                </button>
              </div>
            </div>

            <div class="load-more">
              <button>LOAD MORE</button>
            </div>
            <div class="controls">
              <!-- Next button (sirf tab dikhe jab next group exist kare) -->
              <label
                *ngIf="i < serviceData?.section?.groups.length - 1"
                [for]="'group' + (i + 1)"
                class="btn"
              >
                Next
              </label>
              <!-- Previous button (sirf tab dikhe jab pichla group ho) -->
              <label *ngIf="i > 0" [for]="'group' + (i - 1)" class="btn">
                Previous
              </label>
            </div>
          </div>
        </div>
      </div>

      <section id="page-1" class="dynamicPages">
        <div class="dymanic-page-header">
          <h2 class="">{{ pagesList[1]?.pageName }}</h2>
        </div>
        <div class="schedule-card">
          <div class="day" *ngFor="let day of days; let i = index">
            <div class="icon">
              <i class="fas fa-clock" [ngClass]="{ active: i === 6 }"></i>
            </div>
            <div class="day-name" [ngStyle]="{ 'font-family': data?.font }">
              {{ day }}
            </div>
            <div class="day-status" [ngStyle]="{ 'font-family': data?.font }">
              All day
            </div>
          </div>
        </div>
      </section>
      <section id="page-2" class="dynamicPages" style="position: relative">
        <div class="dymanic-page-header">
          <h2>{{ pagesList[2]?.pageName }}</h2>
        </div>

        <div style="display: flex; justify-content: flex-start; padding: 30px">
          <div style="text-align: center; width: 100%">
            <!-- Group Name -->
            <h3 style="text-align: center" class="priceGro">
              {{
                abovePriceContactSections[selectedPriceGroupIndex]?.groupName
              }}
            </h3>

            <!-- Subgroups -->
            <div
              *ngFor="
                let subgroup of abovePriceContactSections[
                  selectedPriceGroupIndex
                ]?.subgroups
              "
              class="priceListSUb"
            >
              <h4>{{ subgroup.subgroupName }}</h4>
              <div class="price">₹{{ subgroup.price }}</div>
              <p [innerHTML]="subgroup.description"></p>
              <a href="#" class="">Learn more</a>
              <button class="addTocart">Add to Cart</button>
            </div>

            <!-- Navigation Buttons -->
            <div class="controlBtn" style="margin-top: 10px">
              <button
                (click)="setPriceSelectedGroup(selectedPriceGroupIndex - 1)"
                [disabled]="selectedPriceGroupIndex === 0"
              >
                <img
                  src="../../../../../../../../../../assets/images/icons8-next-page-50.png"
                  alt="next"
                  class="rotate-prev"
                  width="20"
                  height="20"
                />
              </button>

              <button
                (click)="setPriceSelectedGroup(selectedPriceGroupIndex + 1)"
                [disabled]="
                  selectedPriceGroupIndex ===
                  abovePriceContactSections.length - 1
                "
              >
                <img
                  src="../../../../../../../../../../assets/images/icons8-next-page-50.png"
                  alt="next"
                  width="20"
                  height="20"
                />
              </button>
            </div>
          </div>
        </div>
      </section>
      <!-- products section -->
      <!-- <section>
        <div *ngFor="let group of aboveProductContactSections; let i = index">
          <div class="product-group-header">
            <h3>{{ group.groupName }}</h3>
            <button (click)="setproductSelectedGroup(i)" class="view-group-btn">
              View Group
            </button>
          </div>

          <div *ngIf="selectedProductGroupIndex === i" class="product-list">
            <div
              *ngFor="
                let subgroup of group.subgroups
                  | slice : 0 : visibleProductsCount
              "
              class="product-item"
            >
              <div class="product-card">
                <div class="product-image">
                  <img
                    [src]="getproductImageUrl(subgroup?.media?.[0])"
                    alt="Product Image"
                    class="product-img"
                  />
                </div>
                <div class="product-info">
                  <h4>{{ subgroup?.subgroupName || "Unnamed Subgroup" }}</h4>
                  <p>
                    {{ subgroup?.description || "No description available" }}
                  </p>
                  <p class="product-price">$ {{ subgroup?.price }}</p>
                </div>
              </div>
            </div>

            <button
              *ngIf="group.subgroups.length > visibleProductsCount"
              (click)="loadMoree()"
              class="load-more-btn"
            >
              Load More
            </button>
          </div>
        </div>
      </section> -->

      <!-- products section -->
      <!-- location -->
      <section id="page-1" class="dynamicPages">
        <div class="dymanic-page-header">
          <h2 class="">Where To Find Us</h2>
        </div>
        <div class="map-container">
          <img
            src="../../../../../../../../../../assets/images/News_gm_demo_Large-1920x0_900x900_crop_center.webp"
            alt="Map"
            class="map-image"
          />

          <div class="location-tooltip">
            <p>
              <strong
                >{{ pageData?.contactUs?.address }} <br />
                {{ pageData?.contactUs?.state }}
                {{ pageData?.contactUs?.zip }}</strong
              >
            </p>
            <p class="phone">📞 {{ pageData?.contactUs?.phoneNumber }}</p>
            <a
              class="directions"
              target="_blank"
              [href]="getGoogleMapsUrl(getFullAddress())"
            >
              Directions →
            </a>
          </div>
        </div>
      </section>
      <!-- location -->

      <!-- Contact Form -->
      <div class="contact-section">
        <!-- Left Info -->
        <div class="contact-info">
          <h2>{{ pageData?.contactUs?.title }}</h2>

          <div class="info-item">
            <span class="icon">📞</span>
            <div>
              <h4>{{ pageData?.contactUs?.subtitle }}</h4>
              <p>{{ pageData?.contactUs?.phoneNumber }}</p>
            </div>
          </div>

          <div class="info-item">
            <span class="icon">📍</span>
            <div>
              <h4>Office location</h4>
              <p>
                {{ pageData?.contactUs?.address }},<br />
                {{ pageData?.contactUs?.city }},<br />
                {{ pageData?.contactUs?.state }}, {{ pageData?.contactUs?.zip }}
              </p>
            </div>
          </div>

          <div class="info-item">
            <span class="icon">✉️</span>
            <div>
              <h4>Send us an email</h4>
              <p>{{ pageData?.contactUs?.email }}</p>
            </div>
          </div>
        </div>

        <!-- Right Form -->
        <div class="contact-form">
          <h3>Available Technician at Your Service!</h3>
          <p class="subtitle">
            AC trouble? Choose Ranchi Service for quick solutions.
          </p>

          <form>
            <div class="form-row">
              <input type="text" placeholder="First name" />
              <input type="text" placeholder="Last name" />
            </div>
            <div class="form-row">
              <input type="email" placeholder="Email" />
              <input type="tel" placeholder="e.g. +44 707 354 64 78" />
            </div>
            <textarea placeholder="Tell us about your request"></textarea>

            <div class="form-check">
              <input type="checkbox" id="terms" />
              <label for="terms">
                I agree with the <a href="#">Terms & Conditions</a> and the
                <a href="#">Privacy & Cookies Policy</a>.
              </label>
            </div>

            <button type="submit">Submit Request</button>
          </form>
        </div>
      </div>

      <section class="dynamicPages">
        <div class="dymanic-page-header">
          <h2 class="">{{ pagesList[3]?.pageName }}</h2>
        </div>
      </section>

      <!-- Footer -->
      <footer
        class="classic-footer"
        [ngStyle]="{ background: data?.selectedColor?.primary || '#ccc' }"
      >
        <p [ngStyle]="{ 'font-family': data?.font }">
          📍 Ranchi, Jharkhand | 📞 {{ pageData?.header?.phones?.mobile }} | ✉️
          inforanchiservice.com
        </p>
        <span>{{ pageData?.footer?.tagline }}</span>
      </footer>
    </ng-container>
  </div>
</ng-template>
