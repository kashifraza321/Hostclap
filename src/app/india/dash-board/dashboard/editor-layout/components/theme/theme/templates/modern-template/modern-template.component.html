<ng-container *ngIf="isLoading; else content">
  <app-loader></app-loader>
</ng-container>
<ng-template #content>
  <div class="classicWrapper" #scrollContainer>
    <ng-container *ngIf="state$ | async as state">
      <div class="url-bar">
        <div class="dots">
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
        <div class="url-content">
          <img
            src="../../../../../../../../../../assets/images/icons8-lock-30 (2).png"
            alt="lock"
          />
          <span class="url-text">https://acrserviceranchi.com</span>
        </div>
      </div>
      <div *ngIf="state$ | async as state">
        <div
          class="top-bar"
          [ngStyle]="{
            background: data?.selectedColor?.primary || '#f88d00',
            'font-size.px':
              state?.preview?.announcement?.fontSize ||
              pageData?.header?.announcement?.fontSize ||
              '16px',

            color:
              state?.preview?.announcement?.fontColor ||
              pageData?.header?.announcement?.fontColor ||
              '#fff'
          }"
        >
          <span
            [innerHTML]="
              state?.preview?.announcement?.message?.trim() ||
              pageData?.header?.announcement?.message?.trim() ||
              'AC Repairing ?'
            "
          ></span>
          <div
            *ngIf="
              state?.preview?.announcement?.actionButton !== false &&
              pageData?.header?.announcement?.actionButton !== false
            "
          >
            <button *ngIf="state?.preview?.announcement?.actionButton">
              {{
                state?.preview?.announcement?.actionButton?.buttonText ||
                  pageData?.header?.announcement?.actionButton?.buttonText ||
                  "Send a message"
              }}
            </button>
          </div>
        </div>
      </div>

      <!-- Top Bar -->

      <!-- new bar -->
      <div
        class="classic-top-bar"
        [ngStyle]="{
          background: data?.selectedColor?.secondary || '#9C27B0'
        }"
      >
        <span class="topBarText" [ngStyle]="{ 'font-family': data?.font }"
          >Need AC Help?</span
        >
        <button class="classic-btn" [ngStyle]="{ 'font-family': data?.font }">
          Contact Us
        </button>
      </div>
      <!-- announcement -->

      <!-- announcement -->

      <!-- Header Info -->
      <header class="classic-header-info">
        <div [ngStyle]="{ 'font-family': data?.font }">
          <i class="bi bi-geo-alt-fill"></i>
          <span class="addresTXt" [ngStyle]="{ 'font-family': data?.font }">
            {{ pageData?.contactUs?.address }} {{ pageData?.contactUs?.city }}
            {{ pageData?.contactUs?.state }}</span
          >
        </div>
        <div [ngStyle]="{ 'font-family': data?.font }">
          <i class="bi bi-telephone-fill"></i>
          <!-- <pre>{{ pageData | json }}</pre> -->
          {{ pageData?.header?.phones?.mobile }}
        </div>
      </header>

      <!-- Navigation -->
      <nav
        [class.scrolled]="isScrolled"
        class="classic-nav"
        [ngStyle]="{
          background: !isScrolled
            ? state?.preview?.menu?.menuBackgroudColour ||
              pageData?.header?.menu?.menuBackgroudColour
            : 'transparent',

          'font-size':
            state?.preview?.menu?.fontSize ||
            pageData?.header?.menu?.fontSize ||
            '16px',
          'text-align':
            state?.preview?.menu?.alignment ||
            pageData?.header?.menu?.alignment ||
            'left'
        }"
      >
        <div
          class="logoSection"
          [class.scrolled]="isScrolled"
          *ngIf="state$ | async as state"
        >
          <!-- <img
          src="../../../../../../../../../../assets/images/icons8-huawei-logo-64.png"
          alt="logo"
          width="70"
          height="70"
        /> -->
          <!-- <img
          [src]="getSanitizedLogoUrl()"
          [ngStyle]="{
            width: logoForm.get('logoSize')?.value + 'px',
            'text-align': logoForm.get('alignment')?.value
          }"
          alt="logo"
          width="70"
          height="70"
        /> -->
          <div
            [ngStyle]="{
              'text-align':
                state?.preview?.logo?.alignment ||
                pageData?.header?.logo?.alignment ||
                'center'
            }"
          >
            <img
              [src]="getLogoUrl()"
              [ngStyle]="{
                width:
                  (state?.preview?.logo?.logoSize ||
                    pageData?.header?.logo?.logoSize ||
                    70) + 'px'
              }"
              alt="logo"
            />
          </div>
        </div>
        <ul>
          <!-- <li *ngFor="let page of data?.pageData">
        <a href="#">{{ page.pageName }}</a>
      </li> -->
          <li *ngFor="let page of pagesList; let i = index">
            <a
              href="javascript:void(0)"
              (click)="scrollToSection('page-' + i)"
              [ngStyle]="{
                color:
                  state?.preview?.menu?.menuFontColour ||
                  pageData?.header?.menu?.menuFontColour,

                'font-size':
                  state?.preview?.menu?.fontSize ||
                  pageData?.header?.menu?.fontSize ||
                  '15px',
                'text-align':
                  state?.preview?.menu?.alignment ||
                  pageData?.header?.menu?.alignment ||
                  'center'
              }"
              >{{ page.pageName }}</a
            >
          </li>
        </ul>
      </nav>

      <!-- Hero -->

      <section
        class="classic-hero hero"
        *ngIf="state$ | async as state"
        [style.background-image]="getCoverUrl(state)"
        [ngStyle]="{
          opacity:
            (state?.preview?.cover?.opacity ||
              pageData?.header?.cover?.opacity ||
              100) / 100
        }"
      >
        <!-- {{ getCoverUrl(state) | json }} -->
        <div class="overlay">
          <div class="hero-text" *ngIf="state$ | async as state">
            <h1
              [ngStyle]="{
                'font-family': data?.font,
                color:
                  state?.preview?.titles?.titleColour ||
                  pageData?.header?.titles?.titleColour,

                'text-align':
                  state?.preview?.titles?.titleAlignment ||
                  pageData?.header?.titles?.titleAlignment ||
                  'center'
              }"
            >
              {{
                state?.preview?.titles?.buisnessName ||
                  pageData?.header?.titles?.buisnessName ||
                  "Your Main Title"
              }}
            </h1>
            <p
              [ngStyle]="{
                'font-family': data?.font,
                color:
                  state?.preview?.titles?.subtitleColour ||
                  pageData?.header?.titles?.subtitleColour,

                'text-align':
                  state?.preview?.titles?.subtitleAlignment ||
                  pageData?.header?.titles?.subtitleAlignment ||
                  'left'
              }"
            >
              {{
                state?.preview?.titles?.subtitle ||
                  pageData?.header?.titles?.subtitle ||
                  "Your subtitle"
              }}
            </p>
          </div>
        </div>
      </section>
      <section id="page-0" class="dynamicPages">
        <div class="dymanic-page-header">
          <h2 class="">{{ pagesList[0]?.pageName }}</h2>
        </div>
      </section>
      <!-- offer -->
      <section class="offerSection">
        <div class="mainContainer">
          <div class="offer-banner">
            <div class="yellow-polygon">
              <img
                src="../../../../../../../../../../assets/images/icons8-discount-48.png"
                alt="Offer"
              />
            </div>
            <div class="offer-text" [ngStyle]="{ 'font-family': data?.font }">
              <h3>
                {{
                  state?.preview?.offer?.title ||
                    pageData?.offer?.title ||
                    "offer"
                }}
              </h3>
              <p>
                <span
                  [innerHTML]="
                    state?.preview?.offer?.description?.trim() ||
                    pageData?.offer?.description?.trim() ||
                    'AC Repairing ?'
                  "
                >
                </span>
              </p>
            </div>
          </div>
        </div>
      </section>
      <!-- gallery section -->
      <section class="gallery-section">
        <div class="mainContainer">
          <div
            *ngIf="pageData?.gallery?.images?.length"
            [ngStyle]="{ 'font-family': data?.font }"
          >
            <h2 class="gradientHeading" *ngIf="pageData?.gallery?.titleVisible">
              {{ pageData.gallery.title }}
            </h2>

            <div class="gallery-grid">
              <!-- Row 1 (3 images) -->
              <div class="row-1">
                <div
                  class="gallery-item"
                  *ngFor="let img of pageData.gallery.images.slice(0, 3)"
                >
                  <img [src]="getGalleryImageUrl(img)" alt="Gallery Image" />
                </div>
              </div>

              <!-- Row 2 (2 images) -->
              <div class="row-2">
                <div
                  class="gallery-item"
                  *ngFor="let img of pageData.gallery.images.slice(3, 5)"
                >
                  <img [src]="getGalleryImageUrl(img)" alt="Gallery Image" />
                </div>
              </div>

              <!-- Row 3 (5 images) -->
              <div class="row-3">
                <div
                  class="gallery-item"
                  *ngFor="let img of pageData.gallery.images.slice(5, 10)"
                >
                  <img [src]="getGalleryImageUrl(img)" alt="Gallery Image" />
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- gallery section -->

      <div class="serviceSection">
        <div class="mainContainer">
          <div class="" [ngStyle]="{ 'font-family': data?.font }">
            <h2 class="gradientHeading">
              {{
                state?.preview?.offer?.title ||
                  serviceData?.section?.sectionTitle ||
                  "offer"
              }}
            </h2>
          </div>

          <ng-container
            *ngFor="let group of serviceData?.section?.groups; let i = index"
          >
            <input
              type="radio"
              name="groupStep"
              [id]="'group' + i"
              [checked]="i === selectedGroupIndex"
              (change)="selectedGroupIndex = i"
              hidden
            />

            <div class="group" *ngIf="i === selectedGroupIndex">
              <h2
                class="section-title"
                [ngStyle]="{ 'font-family': data?.font }"
              >
                {{ group.groupName }}
              </h2>

              <div class="service-container">
                <div
                  class="service-card"
                  *ngFor="
                    let sub of group?.subgroups.slice(0, visibleSubgroupsCount)
                  "
                >
                  <div class="imgWrp">
                    <img
                      [src]="getImageUrl(sub.media?.[0])"
                      alt="{{ sub.subgroupName || 'Service Image' }}"
                      class="service-image"
                    />
                  </div>
                  <div class="serviceTItleWrap">
                    <h3
                      class="service-title"
                      [ngStyle]="{ 'font-family': data?.font }"
                    >
                      {{ sub.subgroupName }}
                    </h3>

                    <h4
                      class="service-desc"
                      [ngStyle]="{ 'font-family': data?.font }"
                    >
                      {{ sub.description }}
                    </h4>
                    <button
                      class="btn"
                      [ngStyle]="{ 'font-family': data?.font }"
                    >
                      Request Service
                    </button>

                    <a
                      href="#"
                      class="learn-more"
                      [ngStyle]="{ 'font-family': data?.font }"
                    >
                      Learn more
                    </a>
                    <a
                      href="#"
                      class="learn-more"
                      [ngStyle]="{ 'font-family': data?.font }"
                    >
                      Learn more
                    </a>
                  </div>
                </div>
              </div>

              <div
                class="buttonCont"
                *ngIf="visibleSubgroupsCount < (group?.subgroups?.length || 0)"
              >
                <button class="loadMore_btn" (click)="loadMore()">
                  Load More
                </button>
              </div>

              <div class="controls">
                <!-- Next button -->
                <label
                  *ngIf="i < serviceData?.section?.groups.length - 1"
                  [for]="'group' + (i + 1)"
                  class="btn"
                  (click)="selectedGroupIndex = i + 1"
                  [class.disabled]="
                    i === serviceData?.section?.groups.length - 1
                  "
                >
                  Next
                </label>

                <!-- Previous button -->
                <label
                  *ngIf="i > 0"
                  [for]="'group' + (i - 1)"
                  class="btn"
                  (click)="selectedGroupIndex = i - 1"
                  [class.disabled]="i === 0"
                >
                  Previous
                </label>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

      <!-- Services -->

      <section
        id="page-1"
        class="dynamicPages"
        [ngStyle]="{ 'font-family': data?.font }"
      >
        <div class="mainContainer">
          <div class="dymanic-page-header">
            <h2 class="gradientHeading">{{ pagesList[1]?.pageName }}</h2>
          </div>

          <div class="schedule-card">
            <div
              class="day"
              *ngFor="let day of days; let i = index"
              [class.today]="i === 0"
            >
              <div class="day-name" [ngStyle]="{ 'font-family': data?.font }">
                {{ day }}
              </div>
              <div class="day-status" [ngStyle]="{ 'font-family': data?.font }">
                All day
              </div>
            </div>
          </div>
        </div>
      </section>

      <section
        id="page-2"
        class="dynamicPages"
        [ngStyle]="{ 'font-family': data?.font }"
        style="position: relative"
      >
        <div class="dymanic-page-header">
          <div class="mainContainer">
            <h2 class="gradientHeading">{{ pagesList[2]?.pageName }}</h2>
          </div>
        </div>

        <div class="price-section dark">
          <div class="mainContainer">
            <div class="price-card">
              <!-- Group Name -->
              <h3 class="price-group-title">
                {{
                  abovePriceContactSections[selectedPriceGroupIndex]?.groupName
                }}
              </h3>

              <!-- Subgroups -->
              <div class="subgroupContainer">
                <div
                  *ngFor="
                    let subgroup of abovePriceContactSections[
                      selectedPriceGroupIndex
                    ]?.subgroups
                  "
                  class="subgroup-card"
                >
                  <div class="subgroup-header">
                    <h4>{{ subgroup.subgroupName }}</h4>
                    <div class="subgroup-price">₹{{ subgroup.price }}</div>
                  </div>
                  <p
                    class="subgroup-description"
                    [innerHTML]="subgroup.description"
                  ></p>
                  <div class="subgroup-actions">
                    <a href="#" class="learnBtn">Learn more</a>
                    <button class="add-to-cart">Add to Cart</button>
                  </div>
                </div>
              </div>

              <!-- Navigation Buttons -->
              <div class="control-btns">
                <button
                  (click)="setSelectedPriceGroup(selectedPriceGroupIndex - 1)"
                  [disabled]="selectedPriceGroupIndex === 0"
                  class="nav-btn"
                >
                  <img
                    src="../../../../../../../../../../assets/images/icons8-next-page-50.png"
                    alt="previous"
                    class="rotate-prev"
                  />
                  Previous
                </button>

                <button
                  (click)="setSelectedPriceGroup(selectedPriceGroupIndex + 1)"
                  [disabled]="
                    selectedPriceGroupIndex ===
                    abovePriceContactSections.length - 1
                  "
                  class="nav-btn"
                >
                  Next
                  <img
                    src="../../../../../../../../../../assets/images/icons8-next-page-50.png"
                    alt="next"
                  />
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- testimonial section -->
      <div class="testimonial-section dynamicPages">
        <div class="mainContainer">
          <div
            class="dymanic-page-header"
            [ngStyle]="{ 'font-family': data?.font }"
          >
            <h2 class="gradientHeading">Testimonials</h2>
          </div>
          <div class="testiWrap">
            <div
              *ngFor="let group of testimonialGroups"
              class="testimonial-card"
            >
              <div class="testIMg">
                <img
                  *ngIf="group.testimonial.imageUrlSafe"
                  [src]="group.testimonial.imageUrlSafe"
                  alt="Avatar"
                  class="avatar"
                />
              </div>
              <h3>{{ group.testimonial.reviewerName }}</h3>
              <p class="quote">{{ group.testimonial.quote }}</p>
              <p class="date">
                {{ group.testimonial.date | date : "mediumDate" }}
              </p>

              <!-- Rating stars -->
              <div class="rating">
                <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
                  <span
                    class="star"
                    [class.filled]="star <= +group.testimonial.rating"
                    [style.color]="group.testimonial.ratingColour || '#f9f916'"
                    >&#9733;</span
                  >
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- testimonial section -->

      <!-- location -->
      <section
        id="page-1"
        class="dynamicPages"
        [ngStyle]="{ 'font-family': data?.font }"
      >
        <div class="mainContainer">
          <div class="dymanic-page-header">
            <h2 class="gradientHeading">Where To Find Us</h2>
          </div>

          <div class="contactFlex">
            <div class="contact-info">
              <h2 class="gradientHeading">{{ pageData?.contactUs?.title }}</h2>

              <div class="info-item">
                <span class="icon">📞</span>
                <div>
                  <h4>{{ pageData?.contactUs?.subtitle }}</h4>
                  <p>{{ pageData?.contactUs?.phoneNumber }}</p>
                </div>
              </div>

              <div class="info-item">
                <span class="icon">📍</span>
                <div>
                  <h4>Office location</h4>
                  <p>
                    {{ pageData?.contactUs?.address }},<br />
                    {{ pageData?.contactUs?.city }},<br />
                    {{ pageData?.contactUs?.state }},
                    {{ pageData?.contactUs?.zip }}
                  </p>
                </div>
              </div>

              <div class="info-item">
                <span class="icon">✉️</span>
                <div>
                  <h4>Send us an email</h4>
                  <p>{{ pageData?.contactUs?.email }}</p>
                </div>
              </div>
            </div>
            <!-- contact info -->
            <div class="map-container">
              <img
                src="../../../../../../../../../../assets/images/News_gm_demo_Large-1920x0_900x900_crop_center.webp"
                alt="Map"
                class="map-image"
              />

              <div class="map-marker">
                <div class="dot"></div>

                <!-- Tooltip (always visible) -->
                <div class="location-tooltip">
                  <p>
                    <strong>
                      {{ pageData?.contactUs?.address }},
                      {{ pageData?.contactUs?.state }},
                      {{ pageData?.contactUs?.zip }}
                    </strong>
                  </p>
                  <p class="phone">📞 {{ pageData?.contactUs?.phoneNumber }}</p>
                  <a
                    class="directions"
                    target="_blank"
                    [href]="getGoogleMapsUrl(getFullAddress())"
                  >
                    Directions →
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- location -->

      <!-- Contact Form -->
      <div class="contact-section">
        <!-- Left Info -->

        <!-- Right Form -->
        <div class="contact-form">
          <h3>Available Technician at Your Service!</h3>
          <p class="subtitle">
            AC trouble? Choose Ranchi Service for quick solutions.
          </p>

          <form>
            <div class="form-row">
              <input type="text" placeholder="First name" />
              <input type="text" placeholder="Last name" />
            </div>
            <div class="form-row">
              <input type="email" placeholder="Email" />
              <input type="tel" placeholder="e.g. +44 707 354 64 78" />
            </div>
            <textarea placeholder="Tell us about your request"></textarea>

            <div class="form-check">
              <input type="checkbox" id="terms" />
              <label for="terms" [ngStyle]="{ 'font-family': data?.font }">
                I agree with the <a href="#">Terms & Conditions</a> and the
                <a href="#">Privacy & Cookies Policy</a>.
              </label>
            </div>

            <button type="submit">Submit Request</button>
          </form>
        </div>
      </div>

      <section class="dynamicPages" [ngStyle]="{ 'font-family': data?.font }">
        <div class="dymanic-page-header">
          <h2 class="gradientHeading">{{ pagesList[3]?.pageName }}</h2>
        </div>
      </section>

      <!-- Footer -->
      <footer
        class="classic-footer"
        [ngStyle]="{ background: data?.selectedColor?.secondary || '#ccc' }"
      >
        <p [ngStyle]="{ 'font-family': data?.font }">
          📍 {{ pageData?.contactUs?.address }},
          {{ pageData?.contactUs?.city }}, {{ pageData?.contactUs?.state }} | 📞
          {{ pageData?.header?.phones?.mobile }} | ✉️
          {{ pageData?.contactUs?.email }}
        </p>
        <span>{{ pageData?.footer?.tagline }}</span>
      </footer>
    </ng-container>
  </div>
</ng-template>
